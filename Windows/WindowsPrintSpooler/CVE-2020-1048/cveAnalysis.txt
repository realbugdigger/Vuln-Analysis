tags: #lpe #printers #impersonation #clientSideOnlyChecks #privFileWrite

- metadata
	- CVE #: CVE-2020-1048
	- Related CWE(s):
		- Client-Side Enforcement of Server-Side Security - (602)
		- Privilege Context Switching Error - (270)
	- Related CVE(s):
		- CVE-2020-1337
    	- CVE-2020-17001
	- created: 2024-05-23
	- title: Client Side Port Check Vulnerability (CVE-2020-1048)
	- web: https://windows-internals.com/printdemon-cve-2020-1048/
	- platform: Windows
	- descriptor tags: #cve #security #printers


# CVE-2020-1048

## Summary

PrintDemon is an elevation of privilege (EoP) vulnerability that exists in the Windows Print Spooler service as it improperly allows arbitrary file writing on the file system.

A local user can craft an print job (via a SHD file) which contains arbitrary data and an arbitrary file path as SYSTEM. 
This occurs because of two primary reasons:
    - There are specific security checks that exist on the client side when adding a printer port that are missing on the server side, and those checks can be circumvent.
    - The print spooler, when writing the file to disk creates and writes the file as the SYSTEM user if the impersonation token has no context.

## Components affected

	- Windows Print Spooler
    - Windows Services
    - Authorization

## Security Boundaries 

	User - A user cannot access or tamper with the code and data of another user without being authorized.

##  Hashtags

	- #lpe #printers #impersonation #clientSideOnlyChecks #privFileWrite

## Requirements
*what stars needed to align?*

## Fundamental Issue / Root Cause

### Best Fit Vulnerability Class (or CWE) for this CVE
	- Client-Side Enforcement of Server-Side Security - (602)
	- Privilege Context Switching Error - (270)

### Is this CVE the Root Cause or a Causal Factor?

Looking at the requirements, this issue is two fold.
    1. Ability to assign a printer port to an arbitrary file path
    2. Windows Print Spooler contains a Self Impersonation Privilege Escalation

## Patch Info

Microsoft fixed the vulnerability by moving the PortIsValid check inside of LcmXcvDataPort.

### Version
- Date: May 12, 2020
- Link: https://support.microsoft.com/help/4556799

### Treating a Symptom or Cure?

Looks like Microsoft fixed just Server-Side checks of when creating a port, however the Print Spooler self impersonation is still possible.